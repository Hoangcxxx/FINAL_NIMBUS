<main class="content" xmlns:c="http://java.sun.com/jsp/jstl/core">
    <div class="section active">
        <div class="container-fluid">
            <!-- Page Heading -->

            <h1 class="page-title">Bán hàng tại quầy</h1>
            <div class="container-fluid my-4">
                <div class="row">
                    <!-- Left Column (Invoice List, Cart, Product List) -->
                    <div class="col-md-8">
                        <!-- Invoice List -->
                        <div id="show-product" class="me-3">

                            <div class="me-3"> <!-- Chứa nút tạo hóa đơn -->
                                <h4 class="border-bottom pb-2">Hóa Đơn</h4>
                                <div class="me-3">
                                    <button class="btn btn-dark" ng-click="createInvoice()">
                                        <i class="fas fa-plus"></i> Tạo hóa đơn
                                    </button>
                                    <!-- Modal -->

                                </div>
                            </div>
                            <!-- Bảng danh sách hóa đơn -->
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <div class="table-responsive text-nowrap">
                                        <table class="table table-striped table-bordered" width="100%">
                                            <thead class="table">
                                                <tr>
                                                    <th scope="col" class="text-center">#</th>
                                                    <th scope="col" class="text-center">Mã HD</th>
                                                    <th scope="col" class="text-center">Tên NV</th>
                                                    <th scope="col" class="text-center">Tên KH</th>
                                                    <th scope="col" class="text-center">Trạng thái</th>
                                                    <th scope="col" class="text-center">Ngày Tạo</th>
                                                    <th scope="col" class="text-center">Thao tác</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="invoice in unpaidInvoices">
                                                    <td class="text-center">{{ $index + 1 }}</td>
                                                    <td class="text-center">{{ invoice.maHoaDon }}</td>
                                                    <td class="text-center">{{ tenNguoiDung
                                                        }}</td>
                                                    <td class="text-center">{{ invoice.nguoiDung.tenNguoiDung }}</td>
                                                    <td class="text-center">
                                                        <span ng-if="!invoice.trangThai"
                                                            class="badge bg-warning text-dark">chờ</span>
                                                        <span ng-if="invoice.trangThai" class="badge bg-success">Hoàn
                                                            thành
                                                        </span>
                                                    </td>
                                                    <td class="text-center">{{ invoice.ngayTao | date: 'yyyy-MM-dd' }}
                                                    </td>
                                                    <td class="text-center">
                                                        <button class="btn btn-success btn-sm"
                                                            ng-click="selectInvoice(invoice)" title="Chọn hóa đơn">
                                                            <i class="fa-regular fa-circle-check"></i> Chọn
                                                        </button>
                                                        <button class="btn btn-danger btn-sm"
                                                            ng-click="deleteInvoice(invoice.idHoaDon)"
                                                            title="Xóa hóa đơn">
                                                            <i class="fa-solid fa-trash"></i> Xóa
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div id="show-product" class="me-3">
                            <h4 class="border-bottom pb-2">
                                <i class="fas fa-shopping-cart"></i> Giỏ hàng
                            </h4>
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <div class="table-responsive text-center">
                                        <table class="table table-hover table-bordered"
                                            style="width: 100%; border-radius: 8px; overflow: hidden;">
                                            <thead>
                                                <tr>
                                                    <th scope="col">#</th>
                                                    <th scope="col">Hình ảnh</th>
                                                    <th scope="col">Tên sản phẩm</th>
                                                    <th scope="col">Chất liệu</th>
                                                    <th scope="col">Màu sắc</th>
                                                    <th scope="col">Kích thước</th>
                                                    <th scope="col">Số lượng</th>
                                                    <th scope="col">Giá bán</th>
                                                    <th scope="col">Thao Tác</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="item in cartItems"
                                                    style="transition: background-color 0.2s;">
                                                    <td>{{ $index + 1 }}</td>
                                                    <td>
                                                        <img ng-if="item.urlAnh" ng-src="{{item.urlAnh}}"
                                                            alt="{{item.tenSanPham}}" class="img-fluid"
                                                            style="max-width: 100px; height: auto;">
                                                    </td>
                                                    <td>{{ item.tenSanPham }}</td>
                                                    <td>{{ item.chatLieu }}</td>
                                                    <td>{{ item.mauSac }}</td>
                                                    <td>{{ item.kichThuoc }}</td>
                                                    <td>
                                                        <div
                                                            style="display: flex; align-items: center; justify-content: center;">
                                                            <!-- Ô nhập số lượng -->
                                                            <input type="number" ng-model="item.soLuong" min="1"
                                                                ng-blur="updateQuantity(item)"
                                                                style="width: 60px; text-align: center; margin: 0 5px; border-radius: 5px; border: 1px solid #ccc;" />
                                                        </div>
                                                    </td>
                                                    <td>{{ item.giaBan | currency: '' : 0 }} VND</td>
                                                    <td>
                                                        <button class="btn btn-danger btn-sm"
                                                            ng-click="deleteCartItem(item.idSanPhamChiTiet)">
                                                            <i class="fa-solid fa-trash"></i> Xóa
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Invoice List -->
                        <div id="show-product" class="me-3">
                            <h4 class="border-bottom pb-2">
                                <i class="fas fa-tshirt"></i> Sản phẩm
                            </h4>
                            <div id="show-product">
                                <div class="card shadow mb-4">
                                    <div class="card-body">
                                        <div class="col-md-3">
                                            <label class="form-label" style="font-weight: bold;">
                                                <i class="fas fa-search"></i> Tên sản phẩm
                                            </label>
                                            <input type="text" class="form-control" ng-model="search.tenSanPham"
                                                placeholder="Tìm theo tên sản phẩm..." style="border-radius: 10px;">
                                        </div>
                                        <div class="table-responsive text-center mt-4"
                                            style="max-height: 540px; overflow-y: auto;">
                                            <table class="table table-hover" width="100%">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">#</th>
                                                        <th scope="col">Hình ảnh</th>
                                                        <th scope="col">Mã sản phẩm</th>
                                                        <th scope="col">Tên sản phẩm</th>
                                                        <th scope="col">Danh mục</th>
                                                        <th scope="col">Đơn giá</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="show-user">
                                                    <tr ng-repeat="sp in sanPhamChiTietList | filter:search"
                                                        ng-click="showProductDetails(sp)">
                                                        <td>{{ $index + 1 }}</td>
                                                        <td>
                                                            <img ng-if="sp.urlAnh" ng-src="{{sp.urlAnh}}"
                                                                alt="{{sp.tenSanPham}}" class="img-fluid"
                                                                style="max-width: 100px; height: auto;">
                                                        </td>
                                                        <td>{{ sp.maSanPham }}</td>
                                                        <td>{{ sp.tenSanPham }}</td>
                                                        <td>{{ sp.tenDanhMuc }}</td>
                                                        <td>
                                                            <span ng-if="sp.giaKhuyenMai"
                                                                style="color: #999; text-decoration: line-through; display: block;">
                                                                {{ sp.giaBan | currency: '' : 0 }} VND
                                                            </span>
                                                            <div
                                                                style="color: #f00; font-weight: bold; margin-top: 5px; display: block;">
                                                                {{ sp.giaKhuyenMai || sp.giaBan | currency: '' : 0 }}
                                                                VND
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <h4 class="border-bottom pb-2 text-center"
                            style="font-size: 1.5rem; font-weight: 600; margin-bottom: 20px;">
                            <i class="fa-solid fa-receipt"></i> Thanh Toán Hóa Đơn
                        </h4>
                        <div class="card mb-4 shadow-sm">
                            <div class="card-body">
                                <!-- Tìm kiếm người dùng -->
                                <div class="mb-3">
                                    <label for="searchUser" class="form-label"
                                        style="font-weight: 600; font-size: 1.1rem;">
                                        Tìm kiếm người dùng
                                    </label>
                                    <div class="d-flex position-relative">
                                        <!-- Ô tìm kiếm -->
                                        <input type="text" class="form-control me-2" ng-model="searchTerm"
                                            placeholder="Nhập tên hoặc SĐT" ng-change="filterUsers()"
                                            ng-focus="filterUsers()" style="border-radius: 10px; border: 1px solid #ddd; font-size: 1rem; padding: 12px;
                                               box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;">


                                        <button class="btn btn-primary" data-bs-toggle="modal"
                                            data-bs-target="#addCustomerModal" style="border-radius: 10px; padding: 12px 18px; font-size: 1rem; margin-left: 10px; 
                                                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;">
                                            <i class="fa-solid fa-plus"></i>
                                        </button>
                                    </div>


                                    <ul class="list-group position-absolute w-100 mt-1" style="z-index: 8800;"
                                        ng-show="showDropdown && filteredUsers.length">
                                        <li ng-repeat="user in filteredUsers" ng-click="selectUser(user)"
                                            class="list-group-item list-group-item-action">
                                            <strong>{{user.tenNguoiDung}}</strong> - {{user.sdt}}
                                        </li>
                                    </ul>
                                </div>

                                <!-- Hiển thị thông tin nhân viên -->
                                <div class="mb-3">
                                    <label for="name-acc" class="form-label"
                                        style="font-size: 1.1rem; font-weight: 600; color: #333;">
                                        Nhân viên:
                                    </label>
                                    <label id="name-acc" class="form-control"
                                        style="border-radius: 10px; font-size: 1rem; color: #555;">
                                        {{ tenNguoiDung }}
                                    </label>
                                </div>
                            </div>
                        </div>

                        <hr style="border: 1px solid #090909; margin: 10px 0;">
                        <!-- Chi tiết thanh toán -->
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="invoiceCode" class="form-label" style="font-weight: 600;">
                                    <i class="fa-solid fa-barcode"></i> Mã hóa đơn
                                </label>
                                <input type="text" class="form-control" id="invoiceCode" placeholder="0" readonly
                                    style="font-size: 1rem;" ng-model="selectedInvoice.maHoaDon" />
                            </div>

                        </div>
                        <!-- Form phiếu giảm giá -->
                        <div class="mb-3">
                            <label for="paymentMethod" class="form-label" style="font-weight: 600;">
                                <i class="fas fa-tag"></i> Phiếu giảm giá:
                            </label>
                            <i class="fas fa-plus-circle ml-2" id="show-discount-modal" style="cursor:pointer;"
                                data-bs-toggle="modal" data-bs-target="#voucherModal"></i>
                        </div>

                        <div class="mb-3">
                            <label for="paymentMethod" class="form-label" style="font-weight: 600;">
                                <i class="fa-solid fa-credit-card"></i> Khách hàng thanh toán
                            </label>
                            <i class="fas fa-plus-circle ml-2" id="show-discount-modal" style="cursor:pointer;"
                                data-bs-toggle="modal" data-bs-target="#paymentModal"
                                ng-click="createOrderStatus()"></i>

                            </button>

                            </button>
                        </div>
                        <div class="mb-3">
                            <div class="total-price-info"
                                style="margin-top: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 5px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                                <h3 style="font-size: 1.2em; color: #333;">
                                    <i class="fa-solid fa-money-bill-wave"></i>
                                    Tổng tiền trước giảm giá:
                                    <span style="font-size: 1.5em; color: #ff0000;">
                                        <!-- Hiển thị tổng tiền chưa giảm giá -->
                                        {{ originalTotalPrice | currency: '' : 0 }} VND
                                    </span>
                                </h3>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="total-price-info"
                                style="margin-top: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 5px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                                <h3 style="font-size: 1.2em; color: #333;">
                                    <i class="fa-solid fa-money-bill-wave"></i>
                                    Số tiền giảm:
                                    <span style="font-size: 1.5em; color: #ff0000;">
                                        <!-- Hiển thị số tiền giảm -->
                                        {{ discount | currency: '' : 0 }} VND
                                    </span>
                                </h3>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="total-price-info"
                                style="margin-top: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 5px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                                <h3 style="font-size: 1.2em; color: #333;">
                                    <i class="fa-solid fa-money-bill-wave"></i>
                                    Tổng tiền sau giảm giá:
                                    <span style="font-size: 1.5em; color: #ff0000;">
                                        <!-- Hiển thị tổng tiền sau giảm giá -->
                                        {{ totalPrice | currency: '' : 0 }} VND
                                    </span>
                                </h3>
                            </div>
                        </div>


                        <div class="mb-3">
                            <label for="description" class="form-label" style="font-weight: 600;">
                                <i class="fa-solid fa-comments"></i>Mô tả
                            </label>
                            <textarea class="form-control" id="description" ng-model="description"
                                placeholder="Nhập mô tả tại đây..."
                                style="font-size: 1rem; border-radius: 5px; height: 100px;"></textarea>
                        </div>


                        <!-- Khi chưa chọn voucher -->
                        <div class="mb-3" ng-show="!selectedVoucher">
                            <div class="voucher-default"
                                style="border-radius: 10px; padding: 20px; background-color: #f2f2f2; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); margin: 20px 0;">
                                <h2 style="font-size: 1.2em; color: #333; text-align: center;">
                                    Hiện chưa có voucher nào được áp dụng.
                                </h2>
                                <p style="font-size: 1em; color: #666; text-align: center; margin-top: 10px;">
                                    Hãy chọn hoặc nhập mã voucher để nhận ưu đãi.
                                </p>
                            </div>
                        </div>
                        <!-- Khi đã chọn voucher -->
                        <div class="mb-3" ng-if="selectedVoucher">
                            <div class="voucher-info"
                                style="border-radius: 10px; padding: 20px; background-color: #fff; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); margin: 20px 0;">
                                <div class="voucher-header"
                                    style="display: flex; align-items: center; border-bottom: 2px solid #ff0000; padding-bottom: 10px; margin-bottom: 10px;">
                                    <i class="fas fa-tags"
                                        style="font-size: 1.5em; color: #ff0000; margin-right: 10px;"></i>
                                    <h2 style="font-size: 1.5em; color: #333;">
                                        Voucher áp dụng:
                                        <strong>{{ selectedVoucher.maVoucher }}</strong>
                                    </h2>
                                </div>
                                <div class="voucher-details"
                                    style="background-color: #f9f9f9; border-radius: 5px; padding: 15px; border-left: 5px solid #ff0000;">
                                    <div style="margin-top: 15px; font-size: 1rem; color: #555;">
                                        <p>
                                            <strong>Áp dụng cho đơn hàng từ:</strong>
                                            <span>{{ selectedVoucher.soTienToiThieu | currency:"":0 }} VND</span>
                                            đến
                                            <span>{{ selectedVoucher.giaTriToiDa | currency:"":0 }} VND</span>
                                        </p>
                                        <p>
                                            <strong>Giảm giá:</strong>
                                            <span style="color: #e74c3c; font-weight: bold;">
                                                <!-- Kiểm tra kiểu giảm giá (phần trăm hoặc tiền) -->
                                                <span ng-if="selectedVoucher.kieuGiamGia === false">
                                                    {{ selectedVoucher.giaTriGiamGia }}%
                                                </span>
                                                <span ng-if="selectedVoucher.kieuGiamGia === true">
                                                    {{ selectedVoucher.giaTriGiamGia | currency:"":0 }} VND
                                                </span>
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="d-flex gap-3" style="margin-top: 20px;">
                            <!-- Nút Thanh toán -->
                            <button class="btn btn-success"
                                style="font-size: 1.1rem; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; background: linear-gradient(135deg, #28a745, #1e7e34); border: none; color: white; flex-grow: 1;"
                                ng-click="createHoaDonChiTiet()">
                                <i class="fa-solid fa-check"></i> Thanh toán
                            </button>

                            <!-- Nút Thanh toán và In hóa đơn -->
                            <button class="btn btn-primary"
                                style="font-size: 1.1rem; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; background: linear-gradient(135deg, #007bff, #0056b3); border: none; color: white; flex-grow: 1;"
                                ng-click="thanhtoanvain()">
                                <i class="fa-solid fa-check"></i> Thanh toán và In hóa đơn
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</main>






<!-- The Modal -->
<!-- Modal Confirmation Delete -->
<div id="myModal" ng-show="invoiceToDelete !== null"
    style="display: block; position: fixed; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center; display: flex;">

    <!-- Modal Content -->
    <div
        style="background-color: white; border-radius: 8px; padding: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); width: 350px; text-align: center; transition: all 0.3s ease;">
        <!-- Title -->
        <h2 style="font-size: 1.5rem; margin-bottom: 15px; color: #333;">Xác Nhận Xóa</h2>

        <!-- Message -->
        <p style="font-size: 1rem; color: #555; margin-bottom: 20px;">Bạn có muốn xóa?</p>

        <!-- Action Buttons -->
        <div style="display: flex; justify-content: center; gap: 10px;">
            <!-- Delete Button -->
            <button ng-click="confirmDelete()"
                style="padding: 12px 20px; background-color: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; font-size: 1rem; width: 120px;">
                Xóa
            </button>

            <!-- Close Button -->
            <button ng-click="invoiceToDelete = null"
                style="padding: 12px 20px; background-color: #ddd; color: black; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; font-size: 1rem; width: 120px;">
                Đóng
            </button>
        </div>
    </div>
</div>







<!-- Modal Hiển thị -->
<div id="productDetailsModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="productDetailsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content"
            style="border-radius: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); overflow: hidden;">
            <!-- Modal Header -->
            <div class="modal-header"
                style="background: linear-gradient(135deg, #ff7e5f, #feb47b); color: white; padding: 25px 30px;">
                <h5 class="modal-title" id="productDetailsModalLabel" style="margin: 0;"><i class="fa-solid fa-box"></i>
                    Chọn sản phẩm để mua</h5>
                <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"
                    style="font-size: 1.25rem; background: transparent;"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body" style="padding: 20px 30px; background-color: #f9f9f9;">
                <!-- Bộ lọc tìm kiếm -->
                <div class="mb-4 d-flex flex-wrap gap-3">
                    <!-- Mã sản phẩm -->
                    <div class="filter-item">
                        <label for="productCodeFilter" style="font-weight: bold;">Mã sản phẩm:</label>
                        <input type="text" id="productCodeFilter" ng-model="searchProductCode" class="form-control mb-3"
                            placeholder="Nhập mã sản phẩm">
                    </div>

                    <div class="filter-item">
                        <label for="colorFilter" style="font-weight: bold;">Màu sắc:</label>
                        <select id="colorFilter" ng-model="searchColor" ng-options="color for color in colorOptions"
                            class="form-select mb-3">
                            <option value="">Chọn Màu</option>
                        </select>
                    </div>

                    <div class="filter-item">
                        <label for="sizeFilter" style="font-weight: bold;">Kích thước:</label>
                        <select id="sizeFilter" ng-model="searchSize" ng-options="size for size in sizeOptions"
                            class="form-select mb-3">
                            <option value="">Chọn Kích Thước</option>
                        </select>
                    </div>
                </div>

                <!-- Bảng thông tin sản phẩm -->
                <div class="mb-4">
                    <table class="table table-bordered table-hover"
                        style="border-radius: 8px; border-collapse: collapse;">
                        <thead class="table-light" style="background-color: #f1f1f1;">
                            <tr>
                                <th class="text-center" style="padding: 10px;">#</th>
                                <th class="text-center" style="padding: 10px;">Mã sản phẩm</th>
                                <th class="text-center" style="padding: 10px;">Sản phẩm</th>
                                <th class="text-center" style="padding: 10px;">Màu sắc</th>
                                <th class="text-center" style="padding: 10px;">Kích thước</th>
                                <th class="text-center" style="padding: 10px;">Chất liệu</th>
                                <th class="text-center" style="padding: 10px;">Số lượng</th>
                                <th class="text-center" style="padding: 10px;">Giá bán</th>
                                <th class="text-center" style="padding: 10px;">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="detail in filteredProductDetails() | filter: {ma_san_pham_chi_tiet: searchProductCode}"
                                ng-mouseover="detail.isHovered = true" ng-mouseleave="detail.isHovered = false">
                                <td class="text-center" style="padding: 10px;">{{ $index + 1 }}</td>
                                <td style="padding: 10px;">{{ detail.ma_san_pham_chi_tiet }}</td>
                                <td style="padding: 10px;">{{ detail.ten_san_pham }}</td>
                                <td style="padding: 10px;">{{ detail.ten_mau_sac }}</td>
                                <td style="padding: 10px;">{{ detail.ten_kich_thuoc }}</td>
                                <td style="padding: 10px;">{{ detail.ten_chat_lieu }}</td>
                                <td class="text-center" style="padding: 10px;">{{ detail.so_luong }}</td>
                                <td style="padding: 10px;">
                                    <span ng-if="detail.giaKhuyenMai"
                                        style="color: #999; text-decoration: line-through; display: block;">
                                        {{ detail.gia_ban | currency: '' : 0 }} VND
                                    </span>
                                    <div style="color: #f00; font-weight: bold; margin-top: 5px; display: block;">
                                        {{ detail.gia_khuyen_mai || detail.gia_ban | currency: '' : 0 }} VND
                                    </div>
                                </td>
                                <td class="text-center">
                                    <button class="btn btn-primary" ng-click="addToCart(detail)"
                                        style="border-radius: 50%; padding: 10px 15px;">
                                        <i class="fa fa-shopping-cart"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer" style="padding: 15px; background-color: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                    style="border-radius: 8px; padding: 10px 20px; background-color: #6c757d; color: white;">
                    Đóng
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Nhập số lượng -->
<div id="quantityModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="quantityModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border-radius: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);">
            <div class="modal-header"
                style="background: linear-gradient(135deg, #ff7e5f, #feb47b); color: white; padding: 25px 30px;">
                <h5 class="modal-title" id="quantityModalLabel" style="margin: 0;">
                    <i class="fa fa-shopping-cart"></i> Nhập số lượng
                </h5>
                <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"
                    style="font-size: 1.25rem; background: transparent;"></button>
            </div>
            <div class="modal-body" style="padding: 20px 30px; background-color: #f9f9f9;">
                <label for="quantityInput" style="font-weight: bold;">Số lượng:</label>
                <input type="number" id="quantityInput" ng-model="quantity" class="form-control mb-3" min="1"
                    placeholder="Nhập số lượng" required>
            </div>
            <div class="modal-footer" style="padding: 15px; background-color: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                    style="border-radius: 8px; padding: 10px 20px; background-color: #6c757d; color: white;">
                    Đóng
                </button>
                <button type="button" class="btn btn-primary" ng-click="confirmAddToCart()"
                    style="border-radius: 8px; padding: 10px 20px;">
                    Thêm vào giỏ hàng
                </button>
            </div>
        </div>
    </div>
</div>





<!-- Nút để mở modal -->
<!-- Modal thanh toán -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content"
            style="border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden;">

            <!-- Modal Header -->
            <div class="modal-header"
                style="background: linear-gradient(135deg, #6a11cb, #2575fc); color: white; padding: 20px; border-bottom: 1px solid #ddd;">
                <h5 class="modal-title" id="paymentModalLabel"><i class="fa-solid fa-credit-card"></i> Thanh Toán</h5>
                <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"
                    style="border: none; background: transparent; font-size: 1.25rem;"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body" style="padding: 25px; background-color: #f8f9fa;">

                <!-- Tiền khách đưa -->
                <div class="mb-4" ng-show="selectedPhuongThucThanhToan !== 2 && selectedPhuongThucThanhToan !== 3">
                    <label for="customerPaid" class="form-label" style="font-weight: 600; color: #333;">
                        <i class="fa-solid fa-hand-holding-dollar"></i> Tiền Khách Đưa
                    </label>
                    <input type="text" class="form-control" ng-model="tienKhachDua" ng-change="calculateChange()"
                        placeholder="Nhập số tiền khách đưa"
                        style="font-size: 1.1rem; border-radius: 8px; padding: 12px; border: 1px solid #ddd; transition: all 0.3s ease-in-out; background-color: #fff;">
                </div>


                <!-- Phương thức thanh toán -->
                <div class="mb-4">
                    <label for="paymentMethod" class="form-label" style="font-weight: 600; color: #333;">
                        <i class="fa-solid fa-credit-card"></i> Phương Thức Thanh Toán
                    </label>
                    <div id="paymentMethod" class="btn-group d-flex flex-wrap" role="group">
                        <button type="button" class="btn"
                            ng-class="{'btn-primary': selectedPhuongThucThanhToan === pt.id, 'btn-outline-primary': selectedPhuongThucThanhToan !== pt.id}"
                            ng-repeat="pt in phuongThucThanhToan" ng-click="selectPhuongThucThanhToan(pt.id)"
                            style="font-size: 1rem; border-radius: 8px; padding: 10px 20px; margin: 5px; transition: all 0.3s ease;">
                            {{pt.tenPhuongThuc}}
                        </button>
                    </div>
                </div>

                <!-- Bảng giao dịch -->
                <div class="mb-4">
                    <table class="table" style="border-radius: 8px; border-collapse: collapse;">
                        <thead class="table-light" style="background-color: #f1f1f1;">
                            <tr>
                                <th style="padding: 10px; text-align: left;">STT</th>
                                <th style="padding: 10px; text-align: left;">Mã Giao Dịch
                                </th>
                                <th style="padding: 10px; text-align: left;">Số Tiền Thừa
                                </th>
                                <th style="padding: 10px; text-align: left;">Phương Thức
                                </th>
                                <th style="padding: 10px; text-align: center;">Hành Động
                                </th>
                            </tr>
                        </thead>
                        <tbody id="show-user">
                            <tr>
                                <td style="padding: 10px;">1</td>
                                <td style="padding: 10px;">GD1</td>
                                <td style="padding: 10px;">{{tienThua | currency:'':0}} VND
                                </td>
                                <td style="padding: 10px;">{{phuongThuc}}</td>
                                <td style="padding: 10px; text-align: center;">
                                    <button class="btn btn-danger" ng-click="xoaGiaoDich()"
                                        style="border-radius: 8px; padding: 8px 16px; font-size: 0.9rem; background-color: #dc3545; border: none; color: white;">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Tổng kết thanh toán -->
                <div>
                    <h5 class="fw-semibold" style="font-weight: 600; color: #333;">Tổng Kết
                        Thanh Toán</h5>
                    <div class="mb-3">
                        <div class="total-price-info"
                            style="margin-top: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 5px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                            <h3 style="font-size: 1.2em; color: #333;">
                                <!-- Biểu tượng Font Awesome cho tổng tiền -->
                                <i class="fa-solid fa-money-bill-wave"></i>
                                Tổng tiền cần thanh toán:
                                <span style="font-size: 1.5em; color: #ff0000;">
                                    {{ totalPrice | currency: '' : 0 }} VND
                                </span>
                            </h3>
                        </div>
                    </div>

                    <!-- Tiền thừa -->
                    <div class="mb-3" ng-show="selectedPhuongThucThanhToan !== 2 && selectedPhuongThucThanhToan !== 3">
                        <label for="changeDue" class="form-label" style="font-weight: 600; color: #333;">
                            <i class="fa-solid fa-money-bill-wave-alt"></i> Tiền Thừa
                        </label>
                        <input type="text" class="form-control" ng-model="tienThua" placeholder="0" readonly
                            style="font-size: 1.1rem; background-color: #f8f9fa; border-radius: 8px; padding: 12px; border: 1px solid #ddd;">
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer" style="padding: 20px; border-top: 1px solid #ddd; background-color: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                    style="border-radius: 8px; padding: 10px 20px; background-color: #6c757d; color: white;">
                    Hủy
                </button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" ng-click="xacNhanThanhToan()"
                    style="border-radius: 8px; padding: 10px 20px; background-color: #007bff; color: white;">
                    Xác Nhận
                </button>
            </div>

        </div>
    </div>
</div>





<!-- Modal chọn voucher -->
<div class="modal fade" id="voucherModal" tabindex="-1" aria-labelledby="voucherModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content rounded-5 shadow-lg"
            style="border: none; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);">
            <div class="modal-header" style="background: linear-gradient(to right, #00bcd4, #f32121); color: white;">
                <h5 class="modal-title" id="voucherModalLabel" style="font-weight: 700; font-size: 1.25rem;">Chọn hoặc
                    Nhập Voucher
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Nhập mã giảm giá -->
                <div class="mb-4">
                    <label for="voucherCodeInput" class="form-label" style="font-weight: 600; color: #333;">Nhập mã giảm
                        giá:</label>
                    <div class="input-group">
                        <input type="text" id="voucherCodeInput" class="form-control"
                            style="border-radius: 12px; border: 1px solid #ccc; transition: border-color 0.3s ease, box-shadow 0.3s ease;"
                            placeholder="Nhập mã giảm giá tại đây" ng-model="voucherCode" />
                    </div>
                    <div class="text-danger mt-2" ng-if="voucherError" style="font-size: 0.875rem; color: #e74c3c;">{{
                        voucherError }}
                    </div>
                </div>

                <hr class="my-4" style="border-top: 1px solid #ddd;" />

                <div>
                    <h5 class="fw-semibold" style="font-size: 1.1rem; color: #333;">Danh sách voucher khả dụng:</h5>
                    <div class="list-group" style="max-height: 500px; overflow-y: auto;">
                        <button type="button" class="list-group-item list-group-item-action p-4 mb-3 rounded-3"
                            ng-repeat="voucher in availableVouchers" ng-click="selectVoucher(voucher)" ng-style="{
                                'opacity': (voucher.kiemtravoucher || !voucher.isUsable) ? '0.5' : '1', 
                                'pointer-events': (voucher.kiemtravoucher || !voucher.isUsable) ? 'none' : 'auto', 
                                'cursor': (voucher.kiemtravoucher || !voucher.isUsable) ? 'not-allowed' : 'pointer',
                                'background-color': (voucher.kiemtravoucher || !voucher.isUsable) ? '#f7f7f7' : '#ffffff'
                            }">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong class="text-dark" style="font-size: 1.1rem;">{{voucher.maVoucher}}</strong>
                                    - {{ voucher.moTa }}
                                </div>
                                <span class="badge" ng-style="{
                                    'background': voucher.isUsable ? 'linear-gradient(to right, #28a745, #218838)' : '#e74c3c',
                                    'color': 'white',
                                    'font-size': '14px',
                                    'font-weight': '600',
                                    'border-radius': '15px',
                                    'padding': '5px 10px'
                                }">
                                    {{ voucher.trangThaiGiamGia.tenTrangThaiGiamGia }}
                                </span>
                            </div>
                            <!-- Hiển thị thông tin chi tiết về giá tiền -->
                            <div style="margin-top: 15px; font-size: 1rem; color: #555;">

                                <p>
                                    <strong>Giảm giá:</strong>
                                    <span style="color: #e74c3c; font-weight: bold;">
                                        <!-- Nếu là phần trăm (true) -->
                                        <span ng-if="voucher.kieuGiamGia">
                                            {{ voucher.giaTriGiamGia | currency:"":0 }} VND
                                        </span>
                                        <!-- Nếu là tiền tệ (false) -->
                                        <span ng-if="!voucher.kieuGiamGia">
                                            {{ voucher.giaTriGiamGia | currency:"":0 }} %
                                        </span>
                                    </span>
                                </p>
                                <p>
                                    <strong>Áp dụng cho đơn hàng từ:</strong>
                                    <span>{{ voucher.soTienToiThieu | currency:"":0 }} VND</span>
                                    đến
                                    <span>{{ voucher.giaTriToiDa | currency:"":0 }} VND</span>
                                </p>
                            </div>

                            <!-- Hiển thị trạng thái sử dụng -->
                            <div ng-if="voucher.kiemtravoucher"
                                style="color: #e74c3c; font-weight: bold; font-size: 14px; margin-top: 10px;">
                                <i class="fas fa-times-circle" style="color: #e74c3c; margin-right: 5px;"></i>Đã sử dụng
                            </div>
                            <div ng-if="!voucher.kiemtravoucher && !voucher.isUsable"
                                style="color: #e74c3c; font-weight: bold; font-size: 14px; margin-top: 10px;">
                                <i class="fas fa-ban" style="color: #e74c3c; margin-right: 5px;"></i>Không thể sử dụng
                            </div>
                            <div ng-if="!voucher.kiemtravoucher && voucher.isUsable"
                                style="color: #28a745; font-weight: bold; font-size: 14px; margin-top: 10px;">
                                <i class="fas fa-check-circle" style="color: #28a745; margin-right: 5px;"></i>Có thể sử
                                dụng
                            </div>
                        </button>
                    </div>
                </div>


            </div>
            <div class="modal-footer" style="background-color: #f8f9fa; border-top: 1px solid #ddd; padding: 15px;">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"
                    style="font-weight: 600; color: #495057; border-color: #ccc;">Đóng</button>
                <button type="button" class="btn" ng-click="confirmVoucher()"
                    style="background-color: #090b0d; color: white; font-weight: 600; padding: 12px 20px; border-radius: 25px;">
                    Xác nhận
                </button>
            </div>
        </div>
    </div>
</div>




<!-- Modal In Hóa Đơn -->
<div class="modal fade" id="invoicePrintModal" tabindex="-1" role="dialog" aria-labelledby="invoicePrintModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="store-info">
                    <h4>Tên Cửa Hàng: NB Fasion</h4>
                    <p>Địa Chỉ: 32 Cổ nhuế 2 - Bắc Từ Liêm - Hà Nội</p>
                    <p>Số Điện Thoại: 0989899999</p>
                </div>
                <hr>
                <h6>Thông Tin Hóa Đơn</h6>
                <div>
                    <p><strong>Mã Hóa Đơn:</strong> {{selectedInvoice.maHoaDon}}</p>
                    <p><strong>Tên Người Nhận:</strong> {{selectedInvoice.tenNguoiNhan}}
                    </p>
                    <p><strong>Ngày Tạo:</strong> {{selectedInvoice.ngayTao |
                        date:'dd/MM/yyyy'}}</p>
                    <p><strong>Sản phẩm mua:</strong></p>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Sản Phẩm</th>
                                <th>Màu Sắc</th>
                                <th>Kích Thước</th>
                                <th>Số Lượng</th>
                                <th>Đơn Giá</th>
                                <th>Tổng Tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="item in cartItems">
                                <td>{{ $index + 1 }}</td>
                                <td>{{ item.tenSanPham }}</td>
                                <td>{{ item.mauSac }}</td>
                                <td>{{ item.kichThuoc }}</td>
                                <td>{{ item.soLuong }}</td>
                                <td>{{ item.giaBan | currency: '' : 0 }} ₫</td>
                                <td>{{ item.soLuong * item.giaBan | currency: '' : 0 }}
                                    ₫</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="total-price text-right">
                    <h5 style="font-weight: bold;">Tổng Tiền Hàng:</h5>
                    <label class="form-control" style="font-size: 1.5rem; font-weight: bold; text-align: right;">
                        {{ totalPrice | currency: '' : 0 }} ₫
                    </label>
                </div>
            </div>
            <div class="signature">
                <p style="font-weight: bold;">Người Lập Hóa Đơn</p>
                <p>(Ký và ghi rõ họ tên)</p>
                <p>Nhân viên </p>
            </div>
        </div>
    </div>
</div>




<!-- Modal Thêm Khách Hàng -->
<div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content rounded-5 shadow-lg"
            style="border: none; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);">
            <div class="modal-header" style="background: linear-gradient(to right, #00bcd4, #f32121); color: white;">
                <h5 class="modal-title" id="addCustomerModalLabel" style="font-weight: 700; font-size: 1.25rem;">
                    Thêm Khách Hàng Mới
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Tên Khách Hàng -->
                <div class="mb-3">
                    <label for="newCustomerName" class="form-label" style="font-weight: 600; color: #333;">Tên Khách
                        Hàng:</label>
                    <input type="text" id="newCustomerName" class="form-control" ng-model="newCustomer.tenNguoiDung" />
                </div>

                <!-- SĐT -->
                <div class="mb-3">
                    <label for="newCustomerPhone" class="form-label" style="font-weight: 600; color: #333;">SĐT:</label>
                    <input type="text" id="newCustomerPhone" class="form-control" ng-model="newCustomer.sdt" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" ng-click="addCustomer()">Thêm</button>
            </div>
        </div>
    </div>
</div>