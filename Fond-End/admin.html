<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='/view-admin/assets/image/favicon1.png' rel='icon' type='image/x-icon' />
    <link rel="stylesheet" href="/view-admin/assets/css/admin.css">
    <link rel="stylesheet" href="/view-admin/assets/css/toast-message.css">
    <link href="/view-admin/assets/font/font-awesome-pro-v6-6.2.0/css/all.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/view-admin/assets/css/admin-responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="lib/angular.js"></script>
    <script src="lib/angular-route.js"></script>
    <link rel="stylesheet" href="lib/bootstrap.css">
    <script src="lib/font-fontawesome-ae333ffef2.js"></script>
    <script src="view-admin/controllers/DonHangController.js"></script>
    <script src="view-admin/controllers/KhachHangController.js"></script>
    <script src="view-admin/controllers/SanPhamController.js"></script>
    <script src="view-admin/controllers/ThongKeController.js"></script>
    <script src="view-admin/controllers/TrangChuController.js"></script>
    <script src="view-admin/controllers/BanHangController.js"></script>
    <script src="view-admin/controllers/ChatLieuController.js"></script>
    <script src="view-admin/controllers/KichThuocController.js"></script>
    <script src="view-admin/controllers/MauSacController.js"></script>
    <script src="view-admin/controllers/DanhMucController.js"></script>
    <script src="view-admin/controllers/PhieuGiamGiaController.js"></script>
    <script src="view-admin/controllers/DotGiamGiaController.js"></script>
    <script src="view-admin/views/SanPhamEven/addSanPhamController.js"></script>
    <script src="view-admin/views/SanPhamEven/detailSanPhamController.js"></script>
    <script src="view-admin/views/HoaDonEven/detailHoaDonController.js"></script>
    <script src="view-admin/views/KhuyenMaiEven/dotKhuyenMai/addDotKhuyenMaiController.js"></script>
    <script src="view-admin/views/KhuyenMaiEven/phieuKhuyenMai/addPhieuKhuyenMaiController.js"></script>
    <title>Quản lý cửa hàng</title>
</head>

<body id="page-top" ng-app="myApp">
    <div class="container-fluid" ng-controller="ngController">
        <div ng-include="'view-admin/layouts/_header.html'"></div>
    </div>
    <script>
        var app = angular.module("myApp", ["ngRoute"]);

        app.config(function ($routeProvider) {
            $routeProvider
                .when('/', {
                    templateUrl: 'view-admin/views/trangchu.html',
                    controller: TrangChuController
                })
                .when('/ban_hang', {
                    templateUrl: 'view-admin/views/banhang.html',
                    controller: BanHangController
                })
                .when('/phieu_giam_gia', {
                    templateUrl: 'view-admin/views/phieugiamgia.html',
                    controller: PhieuGiamGiaController
                })
                .when('/dot_giam_gia', {
                    templateUrl: 'view-admin/views/dotgiamgia.html',
                    controller: DotGiamGiaController
                })
                .when('/don_hang', {
                    templateUrl: 'view-admin/views/donhang.html',
                    controller: DonHangController
                })
                .when('/add_hd/:id', {
                    templateUrl: 'view-admin/views/HoaDonEven/detaiHoaDon.html',
                    controller: detailHoaDonController
                })
                .when('/san_pham', {
                    templateUrl: 'view-admin/views/sanpham.html',
                    controller: SanPhamController
                })
                .when('/add_sp/:id', {
                    templateUrl: 'view-admin/views/SanPhamEven/addSanPham.html',
                    controller: addSanPhamController
                })
                .when('/detail_sp/:id', {
                    templateUrl: 'view-admin/views/SanPhamEven/detailSanPham.html',
                    controller: detailSanPhamController
                })
                .when('/add_dot_km', {
                    templateUrl: 'view-admin/views/KhuyenMaiEven/dotKhuyenMai/addDotKhuyenMai.html',
                    controller: addDotKhuyenMaiController
                })
                .when('/add_dot_km/:id', {
                    templateUrl: 'view-admin/views/KhuyenMaiEven/dotKhuyenMai/addDotKhuyenMai.html',
                    controller: addDotKhuyenMaiController
                })
                .when('/add_phieu_km/:id', {
                    templateUrl: 'view-admin/views/KhuyenMaiEven/phieuKhuyenMai/addPhieuKhuyenMai.html',
                    controller: addPhieuKhuyenMaiController
                })
                .when('/add_phieu_km', {
                    templateUrl: 'view-admin/views/KhuyenMaiEven/phieuKhuyenMai/addPhieuKhuyenMai.html',
                    controller: addPhieuKhuyenMaiController
                })
                .when('/kich_thuoc', {
                    templateUrl: 'view-admin/views/kichthuoc.html',
                    controller: KichThuocController
                })
                .when('/mau_sac', {
                    templateUrl: 'view-admin/views/mausac.html',
                    controller: MauSacController
                })
                .when('/chat_lieu', {
                    templateUrl: 'view-admin/views/chatlieu.html',
                    controller: ChatLieuController
                })
                .when('/danh_muc', {
                    templateUrl: 'view-admin/views/danhmuc.html',
                    controller: DanhMucController
                })
                .when('/khach_hang', {
                    templateUrl: 'view-admin/views/khachhang.html',
                    controller: KhachHangController
                })
                .when('/thong_ke', {
                    templateUrl: 'view-admin/views/thongke.html',
                    controller: ThongKeController
                })
                .otherwise({
                    redirectTo: '/'
                })
        });
        app.controller("ngController", function ($scope, $http) {
            // Kiểm tra người dùng đã đăng nhập chưa
            var userInfo = localStorage.getItem("user");
            if (userInfo) {
                $scope.infoUser = JSON.parse(userInfo);  // Lấy thông tin người dùng từ localStorage
                $scope.idNguoiDung = $scope.infoUser.idNguoiDung;  // Lấy tên người dùng
                $scope.tenNguoiDung = $scope.infoUser.tenNguoiDung;  // Lấy tên người dùng
                $scope.vaiTro = $scope.infoUser.vaiTro;  // Lấy thông tin vai trò của người dùng
            } else {
                $scope.infoUser = undefined;
                $scope.tenNguoiDung = undefined;
                $scope.isAdmin = false;  // Nếu chưa đăng nhập, ẩn mục "Trang quản lý"
            }
            // Biến để lưu trữ tab đang hoạt động
            $scope.activeTab = 'trang_chu'; // Tab mặc định là trang chủ
            // Hàm để thay đổi tab khi người dùng nhấn vào mục
            $scope.setActiveTab = function (tab) {
                $scope.activeTab = tab;
            };
            // Đăng xuất
            $scope.dangXuat = function () {
                // Gửi yêu cầu đăng xuất đến API
                $http.post("http://localhost:8080/api/nguoi_dung/dang_xuat")
                    .then(function (response) {
                        // Xóa thông tin người dùng trong localStorage
                        localStorage.removeItem("user");
                        // Xóa idGioHang trong localStorage
                        localStorage.removeItem("idGioHang");
                        // Cập nhật lại giao diện
                        $scope.infoUser = undefined;
                        $scope.tenNguoiDung = undefined;

                        // Thông báo đăng xuất thành công
                        alert("Đăng xuất thành công!");

                        // Chuyển hướng đến trang chủ hoặc giữ nguyên trang sau khi đăng xuất
                        window.location.reload("#!dang_nhap");  // Làm mới route để giao diện được cập nhật
                    }, function (error) {
                        // Nếu có lỗi
                        alert("Đăng xuất thất bại: " + (error.data ? error.data.message : "Lỗi không xác định"));
                    });
            };
        })
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>