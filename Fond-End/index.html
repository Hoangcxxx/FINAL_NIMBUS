<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NB Fasion</title>
    <link rel="stylesheet" href="/view-client/assets/css/style.css">
    <link rel="stylesheet" href="lib/bootstrap.css">
    <link rel="stylesheet" href="view-client/CSS/sanphamct.css">
    <link rel="stylesheet" href="view-client/CSS/ThanhToan.css">
    <link rel="stylesheet" href="view-client/CSS/ThongTinkhachhang.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href='assets/image/favicon1.png' rel='icon' type='image/x-icon' />
    <script src="lib/angular.js"></script>
    <script src="lib/angular-route.js"></script>
    <script src="view-client/controllers/SanPhamController.js"></script>
    <script src="view-client/controllers/ThanhtoanController.js"></script>
    <script src="view-client/controllers/TrangchuController.js"></script>
    <script src="view-client/controllers/SanPhamCTController.js"></script>
    <script src="view-client/controllers/AboutController.js"></script>
    <script src="view-client/controllers/BlogController.js"></script>
    <script src="view-client/controllers/ContactController.js"></script>
    <script src="view-client/controllers/GiohangController.js"></script>
    <script src="view-client/controllers/UserController.js"></script>
    <script src="view-client/controllers/registetController.js"></script>
    <script src="view-client/controllers/ThongTinTKController.js"></script>
    <script src="view-client/controllers/ThanhCongController.js"></script>

</head>

<body ng-app="myApp">
    <div class="container-fluid" ng-controller="ngController">
        <div ng-include="'view-client/layouts/_header.html'"></div>
        <div ng-view></div>
        <div ng-include="'view-client/layouts/_footer.html'"></div>
    </div>

    <script>
        var app = angular.module("myApp", ["ngRoute"]);
        app.config(function ($routeProvider) {
            $routeProvider
                .when("/", {
                    templateUrl: "view-client/views/trangchu.html",
                    controller: TrangchuController
                })
                .when("/about", {
                    templateUrl: "view-client/views/about.html",
                    controller: AboutController
                })
                .when("/user", {
                    templateUrl: "view-client/views/user.html",
                    controller: UserController
                })
                .when("/tk_kh", {
                    templateUrl: "view-client/views/thongtintaikhoan.html",
                    controller: ThongTinTKController
                })
                .when("/thanhcong", {
                    templateUrl: "view-client/views/thanhcong.html",
                    controller: ThanhCongController
                })
                .when("/blog", {
                    templateUrl: "view-client/views/blog.html",
                    controller: BlogController
                })
                .when("/contact", {
                    templateUrl: "view-client/views/contact.html",
                    controller: ContactController
                })  
                .when("/san_pham", {
                    templateUrl: "view-client/views/sanpham.html",
                    controller: SanPhamController
                })
                .when("/san_pham_ct/:id", {
                    templateUrl: "view-client/views/sanphamct.html",
                    controller: SanPhamCTController
                })
                .when("/gio_hang", {
                    templateUrl: "view-client/views/cart.html",
                    controller: GiohangController
                })
                .when("/san_pham_ct/:id", {
                    templateUrl: "view-client/views/sanphamct.html",
                    controller: SanPhamCTController
                })
                .when("/register", {
                    templateUrl: "view-client/views/register.html",
                    controller: registerController
                })
                .when("/thanh_toan", {
                    templateUrl: "view-client/views/thanhtoan.html",
                    controller: ThanhtoanController
                })
                .otherwise({
                    redirectTo: "/"
                });
        });
        app.controller("ngController", function ($scope, $rootScope, $http) {
            // Kiểm tra trạng thái đăng nhập
            const userInfo = localStorage.getItem("user");
            if (userInfo) {
                const user = JSON.parse(userInfo);
                $rootScope.infoUser = true;
                $rootScope.username = user.tenNguoiDung;
                $rootScope.isAdmin = user.idVaiTro === 1; // Kiểm tra vai trò admin
            } else {
                $rootScope.infoUser = false;
                $rootScope.username = null;
                $rootScope.isAdmin = false;
            }

            // Đăng xuất
            $scope.dangXuat = function () {
                const accessToken = localStorage.getItem("accessToken");
                if (accessToken) {
                    $http.post("http://localhost:8080/api/auth/logout", {}, {
                        headers: { 'Authorization': `Bearer ${accessToken}` }
                    }).then(function () {
                        // Xóa dữ liệu sau khi đăng xuất
                        localStorage.removeItem("user");
                        localStorage.removeItem("accessToken");
                        $rootScope.infoUser = false;
                        $rootScope.username = null;

                        // Thông báo đăng xuất
                        Swal.fire({
                            icon: "success",
                            title: "Đăng xuất thành công",
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => window.location.href = "#!");
                    }).catch(function (error) {
                        Swal.fire({
                            icon: "error",
                            title: "Đăng xuất thất bại",
                            text: error.data?.message || "Lỗi không xác định"
                        });
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Không thể đăng xuất",
                        text: "AccessToken không tồn tại",
                    });
                }
            };
        });





    </script>



    </script>
    </script>
    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>

    <script src="lib/bootstrap.js"></script>
    <!-- Nội dung HTML khác -->
    <script src="view-client/assets/javascript/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</body>

</html>