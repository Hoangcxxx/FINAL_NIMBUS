<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NB Fasion</title>
    <link rel="stylesheet" href="/view-client/assets/css/style.css">
    <link rel="stylesheet" href="lib/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href='assets/image/favicon1.png' rel='icon' type='image/x-icon' />
    <!-- Bootstrap CSS -->
    <!-- Font Awesome -->
    <script src="lib/angular.js"></script>
    <script src="lib/angular-route.js"></script>
    <script src="view-client/controllers/SanPhamController.js"></script>
    <script src="view-client/controllers/ThanhtoanController.js"></script>
    <script src="view-client/controllers/TrangchuController.js"></script>
    <script src="view-client/controllers/SanPhamCTController.js"></script>
    <script src="view-client/controllers/AboutController.js"></script>
    <script src="view-client/controllers/BlogController.js"></script>
    <script src="view-client/controllers/ContactController.js"></script>
    <script src="view-client/controllers/GiohangController.js"></script>
    <script src="view-client/controllers/UserController.js"></script>
    <script src="view-client/controllers/ThongTinNguoiDungController.js"></script>
</head>

<body ng-app="myApp">
    <div class="container-fluid" ng-controller="ngController">
        <div ng-include="'view-client/layouts/_header.html'"></div>
        <div ng-view></div>
        <div ng-include="'view-client/layouts/_footer.html'"></div>
    </div>

    <script>
        var app = angular.module("myApp", ["ngRoute"]);
        app.config(function ($routeProvider) {
            $routeProvider
                .when("/", {
                    templateUrl: "view-client/views/trangchu.html",
                    controller: TrangchuController
                })
                .when("/about", {
                    templateUrl: "view-client/views/about.html",
                    controller: AboutController
                })
                .when("/register", {
                    templateUrl: "view-client/views/register.html",
                    controller: UserController
                })
                .when("/user", {
                    templateUrl: "view-client/views/user.html",
                    controller: UserController
                })
                .when("/blog", {
                    templateUrl: "view-client/views/blog.html",
                    controller: BlogController
                })
                .when("/contact", {
                    templateUrl: "view-client/views/contact.html",
                    controller: ContactController
                })
                .when("/san_pham", {
                    templateUrl: "view-client/views/sanpham.html",
                    controller: SanPhamController
                })
                .when("/san_pham_ct/:id", {
                    templateUrl: "view-client/views/sanphamct.html",
                    controller: SanPhamCTController
                })
                .when("/thong_tin_nguoi_dung", {
                    templateUrl: "view-client/views/thongtintaikhoan.html",
                    controller: ThongTinNguoiDungController
                })
                .when("/gio_hang", {
                    templateUrl: "view-client/views/cart.html",
                    controller: GiohangController
                })
                .when("/thanh_toan", {
                    templateUrl: "view-client/views/thanhtoan.html",
                    controller: ThanhtoanController
                })
                .otherwise({
                    redirectTo: "/"
                });
        });
        app.controller("ngController", function ($scope, $http) {
            // Đăng xuất
            $scope.dangXuat = function () {
                // Gửi yêu cầu đăng xuất đến API
                $http.post("http://localhost:8080/api/nguoi_dung/dang_xuat")
                    .then(function (response) {
                        // Xóa thông tin người dùng trong localStorage
                        localStorage.removeItem("user");

                        // Cập nhật lại giao diện
                        $scope.infoUser = undefined;
                        $scope.tenNguoiDung = undefined;

                        // Thông báo đăng xuất thành công
                        alert("Đăng xuất thành công!");

                        // Chuyển hướng đến trang chủ hoặc giữ nguyên trang sau khi đăng xuất
                        window.location.reload();  // Làm mới route để giao diện được cập nhật
                    }, function (error) {
                        // Nếu có lỗi
                        alert("Đăng xuất thất bại: " + (error.data ? error.data.message : "Lỗi không xác định"));
                    });
            };

            // Kiểm tra người dùng đã đăng nhập chưa
            var userInfo = localStorage.getItem("user");
            if (userInfo) {
                $scope.infoUser = JSON.parse(userInfo);  // Lấy thông tin người dùng từ localStorage
                $scope.tenNguoiDung = $scope.infoUser.tenNguoiDung;  // Lấy tên người dùng
            } else {
                $scope.infoUser = undefined;
                $scope.tenNguoiDung = undefined;
            }
        });


    </script>
    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="lib/bootstrap.js"></script>
    <!-- Nội dung HTML khác -->
    <script src="view-client/assets/javascript/script.js"></script>
</body>

</html>